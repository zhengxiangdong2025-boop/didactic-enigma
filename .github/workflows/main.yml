name: Dancing Pet Daily

on:
  schedule:
    # æ¯å¤©UTCæ—¶é—´0ç‚¹è¿è¡Œï¼ˆåŒ—äº¬æ—¶é—´8ç‚¹ï¼‰
    - cron: '0 0 * * *'
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘
  push:
    branches: [ main ]

jobs:
  update-dancing-pet:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Generate dancing pet
      run: |
        # ç”Ÿæˆéšæœºçš„å® ç‰©å’Œèˆžè¹ˆåŠ¨ä½œ
        PETS=("ðŸ¶" "ðŸ±" "ðŸ°" "ðŸ¹" "ðŸ»" "ðŸ¼" "ðŸ¦Š" "ðŸ¯" "ðŸ¦" "ðŸ®")
        DANCES=("ðŸ’ƒ" "ðŸ•º" "ðŸ‘¯" "ðŸ’«" "âœ¨" "ðŸŒŸ" "ðŸŽ‰" "ðŸŽŠ" "ðŸŽ¶" "ðŸŽµ")
        STYLES=("disco" "ballet" "breakdance" "salsa" "robot" "chicken" "floss" "gangnam")
        
        # åŸºäºŽæ—¥æœŸçš„éšæœºä½†å¯é‡çŽ°çš„é€‰æ‹©
        SEED=$(date +%Y%m%d)
        RANDOM_SEED=$((0x$(echo -n "$SEED" | md5sum | cut -c1-8)))
        
        PET_INDEX=$((RANDOM_SEED % ${#PETS[@]}))
        DANCE_INDEX=$((RANDOM_SEED % ${#DANCES[@]}))
        STYLE_INDEX=$((RANDOM_SEED % ${#STYLES[@]}))
        
        PET=${PETS[PET_INDEX]}
        DANCE=${DANCES[DANCE_INDEX]}
        STYLE=${STYLES[STYLE_INDEX]}
        
        # åˆ›å»ºå® ç‰©èˆžè¹ˆASCIIè‰ºæœ¯
        cat > pet_dance.txt << EOF
        
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘     ðŸŽµ DAILY DANCING PET ðŸŽµ     â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
              Today's Star: $PET
        
        Current Dance Style: $STYLE
        Dance Moves: $DANCE$DANCE$DANCE
        
        â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
        â”‚       _     _                     â”‚
        â”‚      ( \___/ )                    â”‚
        â”‚      /       \                    â”‚
        â”‚     /    O    \     $DANCE       â”‚
        â”‚    /           \                  â”‚
        â”‚   (             )                 â”‚
        â”‚    \___________/                  â”‚
        â”‚                                   â”‚
        â”‚     Dancing happily!             â”‚
        â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
        
        Generated: $(date "+%Y-%m-%d %H:%M:%S")
        Seed: $SEED
        
        EOF
        
        # æ›´æ–°README.md
        START_MARKER="<!-- PET_DANCE_START -->"
        END_MARKER="<!-- PET_DANCE_END -->"
        DANCE_CONTENT=$(cat pet_dance.txt)
        
        # åˆ›å»ºæˆ–æ›´æ–°README
        if [ ! -f README.md ]; then
          echo "# Dancing Pet Repository" > README.md
          echo "" >> README.md
          echo "$START_MARKER" >> README.md
          echo "$DANCE_CONTENT" >> README.md
          echo "$END_MARKER" >> README.md
        else
          # å¦‚æžœæ ‡è®°ä¸å­˜åœ¨ï¼Œæ·»åŠ å®ƒä»¬
          if ! grep -q "$START_MARKER" README.md; then
            echo "" >> README.md
            echo "$START_MARKER" >> README.md
            echo "$DANCE_CONTENT" >> README.md
            echo "$END_MARKER" >> README.md
          else
            # æ›¿æ¢çŽ°æœ‰çš„èˆžè¹ˆå†…å®¹
            awk -v start="$START_MARKER" -v end="$END_MARKER" -v new="$DANCE_CONTENT" '
              $0 ~ start { printing=1; print; next }
              $0 ~ end { printing=0; print new; print; next }
              !printing { print }
            ' README.md > README.tmp && mv README.tmp README.md
          fi
        fi
        
    - name: Commit and Push
      run: |
        git config --local user.name "github-actions[bot]"
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git add README.md pet_dance.txt
        git commit -m "ðŸŽ‰ Daily update: Pet dancing! ($(date +%Y-%m-%d))" || echo "No changes to commit"
        git push
